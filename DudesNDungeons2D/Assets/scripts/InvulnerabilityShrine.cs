using UnityEngine;
using System.Collections;

public class InvulnerabilityShrine : MonoBehaviour {
	GameObject angelDust;
	public Sprite angel;
	public Sprite angelAura;
	GameObject player;
	float buffDuration = 10.0f;
	float Distance;
	public AudioClip chant;
	
	// Use this for initialization
	void Start () {
		angelDust = GameObject.FindGameObjectWithTag("AngelDust");
		player = GameObject.FindGameObjectWithTag("Player");
		audio.clip = chant;
	}
	
	// Update is called once per frame
	void Update () {
		Distance = Vector3.Distance(transform.position, player.transform.position);
		if(Input.GetKeyDown(KeyCode.E) && !angelDust.GetComponent<AngelAura>().activateAura && Distance <= 1.0f)//When E is pressed and the shrine
																												//hasn't been activated and the
																												//player is in range
		{
			audio.Play ();//play the sound
			buffPlayer();
		}
	}
	void buffPlayer()
	{
		int tmp;
		tmp = player.GetComponent<player>().pDamage;
		angelDust.GetComponent<AngelAura>().activateAura = true;//the shrine has been activated
		GetComponent<SpriteRenderer>().sprite = angel;//gives the player sprites that illustrates that the shrine has been activated
		player.GetComponent<player>().invulnerable = true;//The player does not take damage
		StartCoroutine("removeBuff");
	}
	IEnumerator removeBuff()
	{
		yield return new WaitForSeconds(buffDuration);//after 10 seconds the buff will wear off
		player.GetComponent<player>().invulnerable = false;
		angelDust.GetComponent<AngelAura>().activateAura = false;
		GetComponent<SpriteRenderer>().sprite = angelAura;
		StopCoroutine("removeBuff");
	}
}
