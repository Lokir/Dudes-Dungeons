using UnityEngine;
using System.Collections;

public class InvulnerabilityShrine : MonoBehaviour {
	GameObject angelDust;
	public Sprite angel;
	public Sprite angelAura;
	GameObject player;
	float buffDuration = 10.0f;
	float Distance;
	public AudioClip chant;
	
	// Use this for initialization
	void Start () {
		angelDust = GameObject.FindGameObjectWithTag("AngelDust");
		player = GameObject.FindGameObjectWithTag("Player");
		audio.clip = chant;
	}
	
	// Update is called once per frame
	void Update () {
		Distance = Vector3.Distance(transform.position, player.transform.position);
		if(Input.GetKeyDown(KeyCode.E) && !angelDust.GetComponent<AngelAura>().activateAura && Distance <= 1.0f)
		{
			audio.Play ();
			buffPlayer();
		}
	}
	void buffPlayer()
	{
		int tmp;
		tmp = player.GetComponent<player>().pDamage;
		angelDust.GetComponent<AngelAura>().activateAura = true;
		GetComponent<SpriteRenderer>().sprite = angel;
		player.GetComponent<player>().invulnerable = true;
		StartCoroutine("removeBuff");
	}
	IEnumerator removeBuff()
	{
		yield return new WaitForSeconds(buffDuration);
		player.GetComponent<player>().invulnerable = false;
		angelDust.GetComponent<AngelAura>().activateAura = false;
		GetComponent<SpriteRenderer>().sprite = angelAura;
		StopCoroutine("removeBuff");
	}
}
